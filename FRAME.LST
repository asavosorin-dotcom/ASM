Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 1
frame.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     ;===========================================================================
      7				     ;DESTR: ax, bx, cx, di
      8				     ;===========================================================================
      9
     10				     ; можно передавать	аргументом символа его адрес в памяти
     11
     12				     DRAW_COL macro height, pos_x, pos_y, symbol
     13					     mov bx, height
     14					     mov cx, pos_x
     15					     mov di, pos_y
     16
     17					     ; mov ax, symbol
     18					     ; push ax
     19
     20					     call draw_column
     21				     ENDM
     22
     23				     ;===========================================================================
     24				     ;DESTR: ax, bx, cx, di
     25				     ;===========================================================================
     26
     27				     DRAW_STR macro length, pos_x, pos_y, symbol
     28					     mov  bx, length
     29					     mov  cx, pos_x
     30					     mov  di, pos_y
     31
     32					     ; mov  ax,	symbol
     33					     ; push ax
     34
     35					     call draw_string
     36				     ENDM
     37
     38				     DRAW_FRAME	macro length, height, pos_x, pos_y, symbol
     39
     40					     lea bx, Symbol_arr
     41					     add bx, symbol
     42
     43					     push [bx]
     44
     45					     DRAW_STR length, pos_x, pos_y, symbol
     46					     DRAW_COL height, pos_x, pos_y, symbol
     47
     48					     Sum_y = pos_y + height - 1
     49					     Sum_x = pos_x + length - 1
     50
     51					     DRAW_STR length, pos_x, Sum_y, symbol
     52					     DRAW_COL height, Sum_x, pos_y, symbol
     53
     54					     add sp, 2
     55
     56				     ENDM
     57
Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 2
frame.asm



     58				     DRAW_FRAME_WORD macro length, height, pos_x, pos_y, symbol
     59
     60					     DRAW_FRAME	length,	height,	pos_x, pos_y, symbol
     61					     BEG = (Sum_y + pos_y) / 2 * 160 + pos_x * 2 + length
     62
     63				     ENDM
     64
     65				     ;очистка экрана
     66				     ;INT 10H 006H
     67
     68	0100			     Start:
     69					     ;
     70	0100  B8 B800			     mov ax, 0B800h
     71	0103  8E C0			     mov es, ax
     72
     73					     ; Подумать	как можно передавать символ для	всех рамок
     74
     75					     DRAW_FRAME_WORD 30, 5, 10,	3, 2
1    76
1    77					     DRAW_FRAME	30, 5, 10, 3, 2
2    78
2    79	0105  BB 0147r			     lea bx, Symbol_arr
2    80	0108  83 C3 02			     add bx, 2
2    81
2    82	010B  FF 37			     push [bx]
2    83
2    84					     DRAW_STR 30, 10, 3, 2
3    85	010D  BB 001E			     mov  bx, 30
3    86	0110  B9 000A			     mov  cx, 10
3    87	0113  BF 0003			     mov  di, 3
3    88
3    89					     ; mov  ax,	2
3    90					     ; push ax
3    91
3    92	0116  E8 0032			     call draw_string
2    93					     DRAW_COL 5, 10, 3,	2
3    94	0119  BB 0005			     mov bx, 5
3    95	011C  B9 000A			     mov cx, 10
3    96	011F  BF 0003			     mov di, 3
3    97
3    98					     ; mov ax, 2
3    99					     ; push ax
3   100
3   101	0122  E8 005C			     call draw_column
2   102
2   103	      =0007			     Sum_y = 3 + 5 - 1
2   104	      =0027			     Sum_x = 10	+ 30 - 1
2   105
2   106					     DRAW_STR 30, 10, Sum_y, 2
3   107	0125  BB 001E			     mov  bx, 30
3   108	0128  B9 000A			     mov  cx, 10
3   109	012B  BF 0007			     mov  di, Sum_y
3   110
3   111					     ; mov  ax,	2
3   112					     ; push ax
3   113
3   114	012E  E8 001A			     call draw_string
Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 3
frame.asm



2   115					     DRAW_COL 5, Sum_x,	3, 2
3   116	0131  BB 0005			     mov bx, 5
3   117	0134  B9 0027			     mov cx, Sum_x
3   118	0137  BF 0003			     mov di, 3
3   119
3   120					     ; mov ax, 2
3   121					     ; push ax
3   122
3   123	013A  E8 0044			     call draw_column
2   124
2   125	013D  83 C4 02			     add sp, 2
2   126
1   127	      =0352			     BEG = (Sum_y + 3) / 2 * 160 + 10 *	2 + 30
1   128
    129
    130					     ;pop bx
    131				     ;	     DRAW_STR 10, 5, 3,	1F03h
    132				     ;	     DRAW_COL 6,  10, 0, 1F03h
    133				     ;
    134				     ;	     DRAW_STR 29, 10, 5
    135				     ;	     DRAW_COL 6,  40, 0
    136
    137	0140  E8 0081			     call print_word_in_frame
    138
    139					     ;DRAW_FRAME 8, 3, 1, 1, 1F03h or 8080h
    140
    141	0143  B4 4C			     mov ah, 4ch
    142	0145  CD 21			     int 21h
    143
    144	0147  1F03 4E03			     Symbol_arr	dw 1F03h, 4E03h
    145
    146	014B				     draw_string proc
    147	014B  55				     push bp
    148	014C  8B EC				     mov bp, sp
    149	014E  83 C5 04				     add bp, 4
    150						     ;mov word ptr es: [bx+160*4l + 80], (4e03h	or 8000h)
    151						     ;mov bx, 80 ;
    152
    153						     ;cx pos_x
    154						     ;di pos_y
    155	0151  4B				     dec bx
    156	0152  D1 E1				     shl cx, 1	     ;
    157	0154  D1 E3				     shl bx, 1	     ;
    158
    159					     ;===== Умножение смещения на 160=======
    160	0156  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    161	      E7 D1 E7
    162	0160  53				     push bx
    163	0161  8B DF				     mov bx, di
    164	0163  D1 E7 D1 E7			     shl di, 2
    165	0167  03 FB				     add di, bx
    166	0169  5B				     pop bx
    167					     ;=================================
    168	016A  03 F9				     add di, cx
    169						     ;add bx, cx
    170
    171	016C  51				     push cx
Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 4
frame.asm



    172	016D  33 C9				     xor cx, cx
    173	016F  8B 4E 00				     mov word ptr cx, [bp]
    174
    175	0172					     string:
    176	0172  26: 89 09					     mov word ptr es:[bx + di],	cx
    177	0175  4B					     dec bx
    178	0176  4B					     dec bx
    179	0177  83 FB 00					     cmp bx, 0
    180	017A  7D F6					     jge string
    181
    182	017C  59				     pop cx
    183
    184	017D  5D				     pop bp
    185
    186	017E  C2 0002				     ret 2
    187
    188	0181				     draw_string endp
    189
    190	0181				     draw_column proc
    191	0181  55				     push bp
    192	0182  8B EC				     mov bp, sp
    193	0184  83 C5 04				     add bp, 4 ; пропускаем адрес возврата
    194
    195						     ;cx pos_x
    196						     ;di pos_y
    197	0187  4B				     dec bx
    198	0188  D1 E1				     shl cx, 1	     ; 2 байта на символ
    199	018A  D1 E3				     shl bx, 1	     ; 2 байта на символ
    200
    201						     ;===== Умножение смещения y на 160=======
    202	018C  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    203	      E7 D1 E7
    204	0196  53				     push bx
    205	0197  8B DF				     mov bx, di
    206	0199  D1 E7 D1 E7			     shl di, 2
    207	019D  03 FB				     add di, bx
    208	019F  5B				     pop bx
    209						     ;=====================================
    210
    211	01A0  50				     push ax
    212	01A1  51				     push cx
    213	01A2  8B C3				     mov ax, bx
    214	01A4  B9 0050				     mov cx, 80
    215	01A7  F7 E1				     mul cx
    216	01A9  8B D8				     mov bx, ax
    217	01AB  59				     pop cx
    218	01AC  58				     pop ax
    219
    220	01AD  03 F9				     add di, cx
    221
    222	01AF  51				     push cx
    223	01B0  8B 4E 00				     mov word ptr cx, [bp]
    224
    225	01B3					     print_column:
    226	01B3  26: 89 09					     mov word ptr es:[bx + di],	cx
    227	01B6  81 EB 00A0				     sub bx, 160
    228							     ;dec bx
Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 5
frame.asm



    229	01BA  83 FB 00					     cmp bx, 0
    230	01BD  7D F4					     jge print_column
    231
    232	01BF  59				     pop cx
    233	01C0  5D				     pop bp
    234
    235	01C1  C2 0002				     ret 2
    236
    237
    238	01C4				     draw_column endp
    239
    240	01C4				     print_word_in_frame proc
    241	01C4  51					     push cx
    242	01C5  57					     push di
    243	01C6  33 C9					     xor cx, cx
    244	01C8  33 FF					     xor di, di
    245	01CA  8A 0E 0080				     mov cl, ds:80h
    246
    247	01CE  80 F9 00					     cmp cl, 0
    248	01D1  74 1C					     je	??return
    249
    250	01D3  FE C9					     dec cl
    251	01D5  BE 0082					     mov si, 82h
    252							     ;BEG equ 5	* 160 +	40
    253	01D8  8B F9					     mov di, cx
    254	01DA  D1 EF D1 EF				     shr di, 2
    255	01DE  D1 E7					     shl di, 1
    256	01E0  F7 DF					     neg di
    257	01E2  83 EF 02					     sub di, 2
    258	01E5  81 C7 0352				     add di, BEG
    259							     ;mov di, BEG ;  
    260	01E9  B4 9F					     mov ah, (1Fh or 88h) ;
    261	01EB						     L:
    262	01EB  AC						     lodsb
    263	01EC  AB						     stosw
    264	01ED  E2 FC						     loop L
    265
    266	01EF						     ??return:
    267	01EF  5F					     pop di
    268	01F0  59					     pop cx
    269	01F1  C3					     ret
    270	01F2				     endp
    271
    272				     end     Start
Turbo Assembler	 Version 4.1	    02/14/26 20:27:51	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/14/26"
??FILENAME			  Text	 "frame	  "
??RETURN			  Near	 DGROUP:01EF
??TIME				  Text	 "20:27:51"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 FRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BEG				  Number 0352
DRAW_COLUMN			  Near	 DGROUP:0181
DRAW_STRING			  Near	 DGROUP:014B
L				  Near	 DGROUP:01EB
PRINT_COLUMN			  Near	 DGROUP:01B3
PRINT_WORD_IN_FRAME		  Near	 DGROUP:01C4
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:0172
SUM_X				  Number 0027
SUM_Y				  Number 0007
SYMBOL_ARR			  Word	 DGROUP:0147

Macro Name

DRAW_COL
DRAW_FRAME
DRAW_FRAME_WORD
DRAW_STR

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  01F2 Word	  Public  CODE
