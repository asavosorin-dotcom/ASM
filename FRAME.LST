Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 1
frame.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     locals @@
      7
      8				     ;===========================================================================
      9				     ;DESTR: ax, bx, cx, di
     10				     ;===========================================================================
     11
     12				     ; можно передавать	аргументом символа его адрес в памяти
     13
     14				     ; надо написать процедуру,	которая	считывает число	из командной строки
     15
     16	*100			     INF_T struc
     17	*000  01*(001E)			     length dw 30
*Warning* frame.asm(17)	Reserved word used as symbol: LENGTH
     18	*002  01*(0007)			     height dw 7
     19	*004  01*(000A)			     pos_x  dw 10
     20	*006  01*(0003)			     pos_y  dw 3
     21	*008			     INF_T ends
     22
     23				     DRAW_COL macro height, pos_x, pos_y, symbol
     24					     mov bx, height
     25					     mov cx, pos_x
     26					     mov di, pos_y
     27
     28					     ; mov ax, symbol
     29					     ; push ax
     30
     31					     call draw_column
     32				     ENDM
     33
     34				     ;===========================================================================
     35				     ;DESTR: ax, bx, cx, di
     36				     ;===========================================================================
     37				     ; 9F96
     38				     DRAW_STR macro length, pos_x, pos_y, symbol
     39					     mov  bx, length
     40					     mov  cx, pos_x
     41					     mov  di, pos_y
     42
     43					     ; mov  ax,	symbol
     44					     ; push ax
     45
     46					     call draw_string
     47				     ENDM
     48
     49				     DRAW_FRAME	macro length, height, pos_x, pos_y, symbol
     50
     51					     call get_num_from_command
     52
     53					     shl dx, 1 ; arr of	words
     54					     lea bx, Symbol_arr
     55					     add bx, dx
     56
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 2
frame.asm



     57					     push cx
     58					     push [bx]
     59
     60					     DRAW_STR length, pos_x, pos_y, symbol
     61					     DRAW_COL height, pos_x, pos_y, symbol
     62
     63					     ; Sum_y = pos_y + height -	1 ; make in func
     64				     ;=====================================================================
     65					     mov di, pos_y
     66					     add di, height
     67					     dec di
     68				     ;=====================================================================
     69					     ; Sum_x = pos_x + length -	1 ; make in func
     70					     ; push di
     71					     DRAW_STR length, pos_x, di, symbol
     72					     ; pop di
     73				     ;=====================================================================
     74					     mov cx, pos_x
     75					     add cx, length
     76					     dec cx
     77				     ;=====================================================================
     78
     79					     DRAW_COL height, cx, pos_y, symbol
     80
     81					     pop bx
     82					     pop cx
     83
     84				     ENDM
     85
     86				     ;очистка экрана
     87				     ;INT 10H 006H
     88
     89	0100			     Start:
     90					     ;
     91	0100  B8 B800			     mov ax, 0B800h
     92	0103  8E C0			     mov es, ax
     93
     94					     ; Подумать	как можно передавать символ для	всех рамок
     95
     96	0105  8A 0E 0080		     mov cl, ds:80h
     97	0109  BE 0082			     mov si, 82h
     98
     99	010C  E8 012F			     call get_num_from_command
    100	010F  89 16 018Fr		     mov  Inf_frame.length, dx
    101
    102	0113  E8 0128			     call get_num_from_command
    103	0116  89 16 0191r		     mov  Inf_frame.height, dx
    104
    105					     DRAW_FRAME	Inf_frame.length, Inf_frame.height , Inf_frame.pos_x, Inf_frame.pos_y, 2
1   106
1   107	011A  E8 0121			     call get_num_from_command
1   108
1   109	011D  D1 E2			     shl dx, 1 ; arr of	words
1   110	011F  BB 0187r			     lea bx, Symbol_arr
1   111	0122  03 DA			     add bx, dx
1   112
1   113	0124  51			     push cx
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 3
frame.asm



1   114	0125  FF 37			     push [bx]
1   115
1   116					     DRAW_STR Inf_frame.length,	Inf_frame.pos_x, Inf_frame.pos_y, 2
2   117	0127  8B 1E 018Fr		     mov  bx, Inf_frame.length
2   118	012B  8B 0E 0193r		     mov  cx, Inf_frame.pos_x
2   119	012F  8B 3E 0195r		     mov  di, Inf_frame.pos_y
2   120
2   121					     ; mov  ax,	2
2   122					     ; push ax
2   123
2   124	0133  E8 0061			     call draw_string
1   125					     DRAW_COL Inf_frame.height,	Inf_frame.pos_x, Inf_frame.pos_y, 2
2   126	0136  8B 1E 0191r		     mov bx, Inf_frame.height
2   127	013A  8B 0E 0193r		     mov cx, Inf_frame.pos_x
2   128	013E  8B 3E 0195r		     mov di, Inf_frame.pos_y
2   129
2   130					     ; mov ax, 2
2   131					     ; push ax
2   132
2   133	0142  E8 008C			     call draw_column
1   134
1   135					     ; Sum_y = Inf_frame.pos_y + Inf_frame.height - 1 ;	make in	func
1   136				     ;=====================================================================
1   137	0145  8B 3E 0195r		     mov di, Inf_frame.pos_y
1   138	0149  03 3E 0191r		     add di, Inf_frame.height
1   139	014D  4F			     dec di
1   140				     ;=====================================================================
1   141					     ; Sum_x = Inf_frame.pos_x + Inf_frame.length - 1 ;	make in	func
1   142					     ; push di
1   143					     DRAW_STR Inf_frame.length,	Inf_frame.pos_x, di, 2
2   144	014E  8B 1E 018Fr		     mov  bx, Inf_frame.length
2   145	0152  8B 0E 0193r		     mov  cx, Inf_frame.pos_x
2   146	0156  8B FF			     mov  di, di
2   147
2   148					     ; mov  ax,	2
2   149					     ; push ax
2   150
2   151	0158  E8 003C			     call draw_string
1   152					     ; pop di
1   153				     ;=====================================================================
1   154	015B  8B 0E 0193r		     mov cx, Inf_frame.pos_x
1   155	015F  03 0E 018Fr		     add cx, Inf_frame.length
1   156	0163  49			     dec cx
1   157				     ;=====================================================================
1   158
1   159					     DRAW_COL Inf_frame.height,	cx, Inf_frame.pos_y, 2
2   160	0164  8B 1E 0191r		     mov bx, Inf_frame.height
2   161	0168  8B C9			     mov cx, cx
2   162	016A  8B 3E 0195r		     mov di, Inf_frame.pos_y
2   163
2   164					     ; mov ax, 2
2   165					     ; push ax
2   166
2   167	016E  E8 0060			     call draw_column
1   168
1   169	0171  5B			     pop bx
1   170	0172  59			     pop cx
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 4
frame.asm



1   171
    172
    173	0173  81 E3 FF00		     and bx, 0ff00h
    174	0177  8B D3			     mov dx, bx
    175
    176	0179  51			     push cx
    177	017A  E8 0134			     call make_fill
    178	017D  59			     pop cx
    179
    180	017E  52			     push dx
    181	017F  E8 0090			     call print_word_in_frame
    182	0182  5A			     pop dx
    183
    184	0183  B4 4C			     mov ah, 4ch
    185	0185  CD 21			     int 21h
    186				     ;===============================================================================================
    187				     ==
    188	0187  1F03 4E03	8B55 04C5	     Symbol_arr	dw 1F03h, 4E03h, 8B55h,	04C5h
    189	018F  001E 0007	000A 0003	     Inf_frame INF_T <>
    190				     ;===============================================================================================
    191				     ==
    192
    193	0197				     draw_string proc
    194	0197  51				     push cx
    195	0198  57				     push di
    196	0199  53				     push bx
    197	019A  55				     push bp
    198	019B  8B EC				     mov bp, sp
    199	019D  83 C5 0A				     add bp, 10
    200						     ;mov word ptr es: [bx+160*4l + 80], (4e03h	or 8000h)
    201						     ;mov bx, 80 ;
    202
    203						     ;cx pos_x
    204						     ;di pos_y
    205	01A0  4B				     dec bx
    206	01A1  D1 E1				     shl cx, 1	     ;
    207	01A3  D1 E3				     shl bx, 1	     ;
    208
    209					     ;===== Умножение смещения на 160 =======
    210	01A5  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    211	      E7 D1 E7
    212	01AF  53				     push bx
    213	01B0  8B DF				     mov bx, di
    214	01B2  D1 E7 D1 E7			     shl di, 2
    215	01B6  03 FB				     add di, bx
    216	01B8  5B				     pop bx
    217					     ;=======================================
    218	01B9  03 F9				     add di, cx
    219						     ;add bx, cx
    220
    221	01BB  51				     push cx
    222	01BC  33 C9				     xor cx, cx
    223	01BE  8B 4E 00				     mov word ptr cx, [bp]
    224
    225	01C1					     string:
    226	01C1  26: 89 09					     mov word ptr es:[bx + di],	cx
    227	01C4  4B					     dec bx
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 5
frame.asm



    228	01C5  4B					     dec bx
    229	01C6  83 FB 00					     cmp bx, 0
    230	01C9  7D F6					     jge string
    231
    232	01CB  59				     pop cx
    233
    234	01CC  5D				     pop bp
    235	01CD  5B				     pop bx
    236	01CE  5F				     pop di
    237	01CF  59				     pop cx
    238	01D0  C3				     ret
    239
    240	01D1				     draw_string endp
    241
    242	01D1				     draw_column proc
    243	01D1  55				     push bp
    244	01D2  8B EC				     mov bp, sp
    245	01D4  83 C5 04				     add bp, 4 ; пропускаем адрес возврата
    246
    247						     ;cx pos_x
    248						     ;di pos_y
    249	01D7  4B				     dec bx
    250	01D8  D1 E1				     shl cx, 1	     ; 2 байта на символ
    251	01DA  D1 E3				     shl bx, 1	     ; 2 байта на символ
    252
    253						     ;===== Умножение смещения y на 160=======
    254	01DC  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    255	      E7 D1 E7
    256	01E6  53				     push bx
    257	01E7  8B DF				     mov bx, di
    258	01E9  D1 E7 D1 E7			     shl di, 2
    259	01ED  03 FB				     add di, bx
    260	01EF  5B				     pop bx
    261						     ;=====================================
    262
    263	01F0  50				     push ax
    264	01F1  51				     push cx
    265	01F2  8B C3				     mov ax, bx
    266	01F4  B9 0050				     mov cx, 80
    267	01F7  F7 E1				     mul cx
    268	01F9  8B D8				     mov bx, ax
    269	01FB  59				     pop cx
    270	01FC  58				     pop ax
    271
    272	01FD  03 F9				     add di, cx
    273
    274	01FF  51				     push cx
    275	0200  8B 4E 00				     mov word ptr cx, [bp]
    276
    277	0203					     print_column:
    278	0203  26: 89 09					     mov word ptr es:[bx + di],	cx
    279	0206  81 EB 00A0				     sub bx, 160
    280							     ;dec bx
    281	020A  83 FB 00					     cmp bx, 0
    282	020D  7D F4					     jge print_column
    283
    284	020F  59				     pop cx
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 6
frame.asm



    285	0210  5D				     pop bp
    286
    287	0211  C3				     ret
    288
    289
    290	0212				     draw_column endp
    291
    292				     ;====================================================================
    293				     ;Start:
    294				     ;	 cx - counter of symbols
    295				     ;	     si	- adress of string
    296				     ;Return: ax - число
    297				     ;Destr: cx, di, si, dx
    298				     ;====================================================================
    299
    300	0212				     print_word_in_frame proc
    301							     ; push cx
    302	0212  55					     push bp
    303	0213  8B EC					     mov bp, sp
    304	0215  83 C5 04					     add bp, 4
    305
    306	0218  57					     push di
    307							     ;xor cx, cx
    308	0219  33 FF					     xor di, di
    309							     ;mov cl, ds:80h
    310				     ;
    311	021B  80 F9 00					     cmp cl, 0
    312	021E  74 1B					     je	@@return
    313				     ;
    314	0220  FE C9					     dec cl
    315							     ;mov si, 82h
    316							     ;BEG equ 5	* 160 +	40
    317	0222  8B F9					     mov di, cx
    318	0224  D1 EF D1 EF				     shr di, 2
    319	0228  D1 E7					     shl di, 1
    320	022A  F7 DF					     neg di
    321	022C  83 EF 02					     sub di, 2
    322	022F  E8 003D					     call get_middle_frame
    323	0232  03 FA					     add di, dx
    324							     ;mov di, BEG ;  
    325	0234  8A 66 01					     mov ah, [bp + 1];
    326	0237						     L:
    327	0237  AC						     lodsb
    328	0238  AB						     stosw
    329	0239  E2 FC						     loop L
    330				     ;
    331	023B						     @@return:
    332	023B  5F					     pop di
    333							     ; pop cx
    334	023C  5D					     pop bp
    335	023D  C3					     ret
    336	023E				     endp
    337
    338				     ;====================================================================
    339				     ; Start:  cx - number of symbols
    340				     ;		       si - adress of string
    341				     ; Destr:  cx, si, dx, ax
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 7
frame.asm



    342				     ; Return: dx - число. dx =	0, если	нет цифры
    343				     ;====================================================================
    344	023E				     get_num_from_command proc
    345	023E  33 D2				     xor dx, dx
    346
    347	0240  80 3C 20				     cmp byte ptr [si],	' '
    348	0243  74 29				     je	@@return
    349
    350	0245  80 3C 30				     cmp byte ptr [si],	'0'
    351	0248  72 24				     jb	@@return
    352
    353	024A  80 3C 39				     cmp byte ptr [si],	'9'
    354	024D  7F 1F				     jg	@@return
    355
    356	024F  33 C0				     xor ax, ax
    357
    358	0251					      @@digit:
    359	0251  AC					     lodsb
    360
    361	0252  51					     push cx
    362	0253  8B CA					     mov cx, dx
    363	0255  D1 E2 D1 E2 D1 E2				     shl dx, 3
    364	025B  03 D1					     add dx, cx
    365	025D  03 D1					     add dx, cx
    366	025F  59					     pop cx
    367
    368							     ;sub ax, '0'
    369	0260  24 0F					     and al, 0fh
    370	0262  03 D0					     add dx, ax
    371	0264  49					     dec cx
    372
    373	0265  80 3C 20					     cmp byte ptr [si],	' '
    374	0268  75 E7					     jne @@digit
    375
    376	026A  49				     dec cx
    377	026B  83 C6 01				     add si, 1 ; skip_space
    378
    379	026E					     @@return:
    380	026E  C3				     ret
    381	026F				     endp
    382
    383				     ;====================================================================
    384				     ; Start: Inf_struc
    385				     ; Destr: dx
    386				     ; Return: dx - число
    387				     ;====================================================================
    388
    389	026F				     get_middle_frame proc
    390	026F  55				     push bp
    391	0270  8B EC				     mov bp, sp
    392
    393						     ; xor dx, dx
    394
    395	0272  8B 16 0193r			     mov dx, Inf_frame.pos_x
    396	0276  D1 E2				     shl dx, 1
    397	0278  03 16 018Fr			     add dx, Inf_frame.length
    398	027C  4A				     dec dx
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 8
frame.asm



    399	027D  D1 E2				     shl dx, 1
    400
    401	027F  50				     push ax
    402	0280  A1 0195r				     mov ax, Inf_frame.pos_y
    403	0283  D1 E0				     shl ax, 1
    404	0285  03 06 0191r			     add ax, Inf_frame.height
    405	0289  48				     dec ax
    406	028A  48				     dec ax
    407	028B  05 0001				     add ax, 1
    408	028E  D1 E8				     shr ax, 1
    409	0290  D1 E0				     shl ax, 1
    410
    411						     ;===== Умножение ax на 80=======
    412	0292  D1 E0 D1 E0 D1 E0	D1+		     shl ax, 5
    413	      E0 D1 E0
    414	029C  53				     push bx
    415	029D  8B D8				     mov bx, ax
    416	029F  D1 E0 D1 E0			     shl ax, 2
    417	02A3  03 C3				     add ax, bx
    418	02A5  5B				     pop bx
    419						     ;=====================================
    420
    421	02A6  03 D0				     add dx, ax
    422
    423	02A8  58				     pop ax
    424
    425	02A9  D1 EA D1 EA			     shr dx, 2
    426	02AD  D1 E2				     shl dx, 1
    427
    428	02AF  5D				     pop bp
    429	02B0  C3				     ret
    430	02B1				     endp
    431				     ;====================================================================
    432				     ; Start: data in struc, bx	- symb
    433				     ; Destr: cx, ax
    434				     ;====================================================================
    435
    436	02B1				     make_fill proc
    437	02B1  55				     push bp
    438	02B2  8B EC				     mov bp, sp
    439
    440	02B4  A1 0191r				     mov ax, Inf_frame.height
    441	02B7  2D 0002				     sub ax, 2
    442
    443	02BA  53				     push bx
    444
    445	02BB  8B 1E 018Fr			     mov bx, Inf_frame.length
    446	02BF  83 EB 02				     sub bx, 2
    447
    448	02C2  8B 0E 0193r			     mov cx, Inf_frame.pos_x
    449	02C6  41				     inc cx
    450
    451	02C7  8B 3E 0195r			     mov di, Inf_frame.pos_y
    452	02CB  47				     inc di
    453
    454	02CC					     @@print_string:
    455
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 9
frame.asm



    456	02CC  E8 FEC8					     call draw_string
    457	02CF  47					     inc di
    458
    459	02D0  48					     dec ax
    460	02D1  3D 0000					     cmp ax, 0
    461	02D4  75 F6					     jne @@print_string
    462
    463	02D6  5B				     pop bx
    464	02D7  5D				     pop bp
    465
    466	02D8  C3				     ret
    467	02D9				     endp
    468				     end     Start
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 10
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/16/26"
??FILENAME			  Text	 "frame	  "
??TIME				  Text	 "14:56:06"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@DIGIT				  Near	 DGROUP:0251
@@PRINT_STRING			  Near	 DGROUP:02CC
@@RETURN			  Near	 DGROUP:023B
@@RETURN			  Near	 DGROUP:026E
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 FRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
DRAW_COLUMN			  Near	 DGROUP:01D1
DRAW_STRING			  Near	 DGROUP:0197
GET_MIDDLE_FRAME		  Near	 DGROUP:026F
GET_NUM_FROM_COMMAND		  Near	 DGROUP:023E
INF_FRAME			  Struct DGROUP:018F INF_T
L				  Near	 DGROUP:0237
MAKE_FILL			  Near	 DGROUP:02B1
PRINT_COLUMN			  Near	 DGROUP:0203
PRINT_WORD_IN_FRAME		  Near	 DGROUP:0212
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:01C1
SYMBOL_ARR			  Word	 DGROUP:0187

Macro Name

DRAW_COL
DRAW_FRAME
DRAW_STR

Structure Name			  Type	Offset

INF_T
 LENGTH				  Word	 0000
 HEIGHT				  Word	 0002
 POS_X				  Word	 0004
 POS_Y				  Word	 0006

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  02D9 Word	  Public  CODE
Turbo Assembler	 Version 4.1	    02/16/26 14:56:06	    Page 11
Error Summary



*Warning* frame.asm(17)	Reserved word used as symbol: LENGTH
