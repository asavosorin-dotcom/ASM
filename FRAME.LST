Turbo Assembler	 Version 4.1	    02/12/26 19:52:17	    Page 1
frame.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     DRAW_COL macro height, pos_x, pos_y
      7					     mov bx, height
      8					     mov cx, pos_x
      9					     mov di, pos_y
     10					     call draw_column
     11				     ENDM
     12
     13				     DRAW_STR macro length, pos_x, pos_y
     14					     mov bx, length
     15					     mov cx, pos_x
     16					     mov di, pos_y
     17					     call draw_string
     18				     ENDM
     19
     20				     DRAW_FRAME	macro length, height, pos_x, pos_y
     21
     22					     DRAW_STR length, pos_x, pos_y
     23					     DRAW_COL height, pos_x, pos_y
     24
     25					     Sum_y = pos_y + height - 1
     26					     Sum_x = pos_x + length - 1
     27
     28					     DRAW_STR length, pos_x, Sum_y
     29					     DRAW_COL height, Sum_x, pos_y
     30
     31				     ENDM
     32
     33				     DRAW_FRAME_WORD macro length, height, pos_x, pos_y
     34
     35					     DRAW_FRAME	length,	height,	pos_x, pos_y
     36					     BEG = (Sum_y + pos_y) / 2 * 160 + pos_x * 2 + length
     37
     38				     ENDM
     39
     40				     ;очистка дисплея
     41				     ;INT 10H 006H
     42
     43	0100			     Start:
     44					     ;переход в	сегмент	видеопамяти
     45	0100  B8 B800			     mov ax, 0B800h
     46	0103  8E C0			     mov es, ax
     47
     48					     DRAW_FRAME_WORD 30, 5, 10,	3
1    49
1    50					     DRAW_FRAME	30, 5, 10, 3
2    51
2    52					     DRAW_STR 30, 10, 3
3    53	0105  BB 001E			     mov bx, 30
3    54	0108  B9 000A			     mov cx, 10
3    55	010B  BF 0003			     mov di, 3
3    56	010E  E8 005B			     call draw_string
2    57					     DRAW_COL 5, 10, 3
Turbo Assembler	 Version 4.1	    02/12/26 19:52:17	    Page 2
frame.asm



3    58	0111  BB 0005			     mov bx, 5
3    59	0114  B9 000A			     mov cx, 10
3    60	0117  BF 0003			     mov di, 3
3    61	011A  E8 0077			     call draw_column
2    62
2    63	      =0007			     Sum_y = 3 + 5 - 1
2    64	      =0027			     Sum_x = 10	+ 30 - 1
2    65
2    66					     DRAW_STR 30, 10, Sum_y
3    67	011D  BB 001E			     mov bx, 30
3    68	0120  B9 000A			     mov cx, 10
3    69	0123  BF 0007			     mov di, Sum_y
3    70	0126  E8 0043			     call draw_string
2    71					     DRAW_COL 5, Sum_x,	3
3    72	0129  BB 0005			     mov bx, 5
3    73	012C  B9 0027			     mov cx, Sum_x
3    74	012F  BF 0003			     mov di, 3
3    75	0132  E8 005F			     call draw_column
2    76
1    77	      =0352			     BEG = (Sum_y + 3) / 2 * 160 + 10 *	2 + 30
1    78
     79
     80				     ;	     DRAW_STR 10, 5, 3
     81				     ;	     DRAW_COL 6,  10, 0
     82				     ;
     83				     ;	     DRAW_STR 29, 10, 5
     84				     ;	     DRAW_COL 6,  40, 0
     85
     86	0135  E8 0093			     call print_word_in_frame
     87
     88					     DRAW_FRAME	8, 3, 1, 1
1    89
1    90					     DRAW_STR 8, 1, 1
2    91	0138  BB 0008			     mov bx, 8
2    92	013B  B9 0001			     mov cx, 1
2    93	013E  BF 0001			     mov di, 1
2    94	0141  E8 0028			     call draw_string
1    95					     DRAW_COL 3, 1, 1
2    96	0144  BB 0003			     mov bx, 3
2    97	0147  B9 0001			     mov cx, 1
2    98	014A  BF 0001			     mov di, 1
2    99	014D  E8 0044			     call draw_column
1   100
1   101	      =0003			     Sum_y = 1 + 3 - 1
1   102	      =0008			     Sum_x = 1 + 8 - 1
1   103
1   104					     DRAW_STR 8, 1, Sum_y
2   105	0150  BB 0008			     mov bx, 8
2   106	0153  B9 0001			     mov cx, 1
2   107	0156  BF 0003			     mov di, Sum_y
2   108	0159  E8 0010			     call draw_string
1   109					     DRAW_COL 3, Sum_x,	1
2   110	015C  BB 0003			     mov bx, 3
2   111	015F  B9 0008			     mov cx, Sum_x
2   112	0162  BF 0001			     mov di, 1
2   113	0165  E8 002C			     call draw_column
1   114
Turbo Assembler	 Version 4.1	    02/12/26 19:52:17	    Page 3
frame.asm



    115
    116	0168  B4 4C			     mov ah, 4ch
    117	016A  CD 21			     int 21h
    118
    119
    120
    121	016C				     draw_string proc
    122
    123						     ;mov word ptr es: [bx+160*4l + 80], (4e03h	or 8000h)
    124						     ;mov bx, 80 ;счетчик
    125
    126						     ;cx pos_x
    127						     ;di pos_y
    128	016C  4B				     dec bx
    129	016D  D1 E1				     shl cx, 1	     ; умножение на 2 (2 байта на символ)
    130	016F  D1 E3				     shl bx, 1	     ; умножение на 2 (2 байта на символ)
    131
    132					     ;=====умножение смещения y	на 160=======
    133	0171  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    134	      E7 D1 E7
    135	017B  53				     push bx
    136	017C  8B DF				     mov bx, di
    137	017E  D1 E7 D1 E7			     shl di, 2
    138	0182  03 FB				     add di, bx
    139	0184  5B				     pop bx
    140					     ;=================================
    141	0185  03 F9				     add di, cx
    142						     ;add bx, cx
    143						     ; переписать вывод	строки!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    144	0187					     string:
    145	0187  26: C7 01	9F03				     mov word ptr es:[bx + di],	(1F03h or 8000h)
    146	018C  4B					     dec bx
    147	018D  4B					     dec bx
    148	018E  83 FB 00					     cmp bx, 0
    149	0191  7D F4					     jge string
    150
    151	0193  C3				     ret;
    152	0194				     draw_string endp
    153
    154	0194				     draw_column proc
    155						     ;cx pos_x
    156						     ;di pos_y
    157	0194  4B				     dec bx
    158	0195  D1 E1				     shl cx, 1	     ; умножение на 2 (2 байта на символ)
    159	0197  D1 E3				     shl bx, 1	     ; умножение на 2 (2 байта на символ)
    160
    161						     ;=====умножение смещения на 160=======
    162	0199  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    163	      E7 D1 E7
    164	01A3  53				     push bx
    165	01A4  8B DF				     mov bx, di
    166	01A6  D1 E7 D1 E7			     shl di, 2
    167	01AA  03 FB				     add di, bx
    168	01AC  5B				     pop bx
    169						     ;=====================================
    170
    171	01AD  50				     push ax
Turbo Assembler	 Version 4.1	    02/12/26 19:52:17	    Page 4
frame.asm



    172	01AE  51				     push cx
    173	01AF  8B C3				     mov ax, bx
    174	01B1  B9 0050				     mov cx, 80
    175	01B4  F7 E1				     mul cx
    176	01B6  8B D8				     mov bx, ax
    177	01B8  59				     pop cx
    178	01B9  58				     pop ax
    179
    180	01BA  03 F9				     add di, cx
    181	01BC					     print_column:
    182	01BC  26: C7 01	9F03				     mov word ptr es:[bx + di],	(1F03h or 8000h)
    183	01C1  81 EB 00A0				     sub bx, 160
    184							     ;dec bx
    185	01C5  83 FB 00					     cmp bx, 0
    186	01C8  7D F2					     jge print_column
    187
    188	01CA  C3				     ret;
    189
    190	01CB				     draw_column endp
    191
    192	01CB				     print_word_in_frame proc
    193	01CB  51					     push cx
    194	01CC  57					     push di
    195	01CD  33 C9					     xor cx, cx
    196	01CF  33 FF					     xor di, di
    197	01D1  8A 0E 0080				     mov cl, ds:80h
    198	01D5  FE C9					     dec cl
    199	01D7  BE 0082					     mov si, 82h ; вот тут могут быть проблемы
    200							     ;BEG equ 5	* 160 +	40
    201	01DA  8B F9					     mov di, cx
    202	01DC  D1 EF D1 EF				     shr di, 2
    203	01E0  D1 E7					     shl di, 1
    204	01E2  F7 DF					     neg di
    205	01E4  83 EF 02					     sub di, 2
    206	01E7  81 C7 0352				     add di, BEG
    207							     ;mov di, BEG ; начало вывода
    208	01EB  B4 9F					     mov ah, (1Fh or 88h) ;задаем цвет на все ячейки
    209	01ED						     L:
    210	01ED  AC						     lodsb
    211	01EE  AB						     stosw
    212	01EF  E2 FC						     loop L
    213
    214	01F1  5F					     pop di
    215	01F2  59					     pop cx
    216	01F3  C3					     ret
    217	01F4				     endp
    218
    219				     end     Start
Turbo Assembler	 Version 4.1	    02/12/26 19:52:17	    Page 5
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/12/26"
??FILENAME			  Text	 "frame	  "
??TIME				  Text	 "19:52:17"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 FRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BEG				  Number 0352
DRAW_COLUMN			  Near	 DGROUP:0194
DRAW_STRING			  Near	 DGROUP:016C
L				  Near	 DGROUP:01ED
PRINT_COLUMN			  Near	 DGROUP:01BC
PRINT_WORD_IN_FRAME		  Near	 DGROUP:01CB
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:0187
SUM_X				  Number 0008
SUM_Y				  Number 0003

Macro Name

DRAW_COL
DRAW_FRAME
DRAW_FRAME_WORD
DRAW_STR

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  01F4 Word	  Public  CODE
