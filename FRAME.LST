Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 1
frame.asm



      1	0000			     .model tiny
      2	0000			     .code
      3
      4				     org 100h
      5
      6				     local @@
      7
      8				     ;===========================================================================
      9				     ;DESTR: ax, bx, cx, di
     10				     ;===========================================================================
     11
     12				     ; можно передавать	аргументом символа его адрес в памяти
     13
     14				     ; надо написать процедуру,	которая	считывает число	из командной строки
     15
     16				     DRAW_COL macro height, pos_x, pos_y, symbol
     17					     mov bx, height
     18					     mov cx, pos_x
     19					     mov di, pos_y
     20
     21					     ; mov ax, symbol
     22					     ; push ax
     23
     24					     call draw_column
     25				     ENDM
     26
     27				     ;===========================================================================
     28				     ;DESTR: ax, bx, cx, di
     29				     ;===========================================================================
     30				     ; 9F96
     31				     DRAW_STR macro length, pos_x, pos_y, symbol
     32					     mov  bx, length
     33					     mov  cx, pos_x
     34					     mov  di, pos_y
     35
     36					     ; mov  ax,	symbol
     37					     ; push ax
     38
     39					     call draw_string
     40				     ENDM
     41
     42				     DRAW_FRAME	macro length, height, pos_x, pos_y, symbol
     43
     44					     shl dx, 1 ; arr of	words
     45					     lea bx, Symbol_arr
     46					     add bx, dx
     47
     48					     push cx
     49					     push [bx]
     50
     51					     DRAW_STR length, pos_x, pos_y, symbol
     52					     DRAW_COL height, pos_x, pos_y, symbol
     53
     54					     Sum_y = pos_y + height - 1
     55					     Sum_x = pos_x + length - 1
     56
     57					     DRAW_STR length, pos_x, Sum_y, symbol
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 2
frame.asm



     58					     DRAW_COL height, Sum_x, pos_y, symbol
     59
     60					     add sp, 2
     61					     pop cx
     62
     63				     ENDM
     64
     65				     DRAW_FRAME_WORD macro length, height, pos_x, pos_y, symbol
     66
     67					     call get_num_from_command ; получаем индекс в массиве символов
     68					     DRAW_FRAME	length,	height,	pos_x, pos_y, symbol
     69					     BEG = (Sum_y + pos_y) / 2 * 160 + pos_x * 2 + length
     70
     71				     ENDM
     72
     73				     ;очистка экрана
     74				     ;INT 10H 006H
     75
     76	0100			     Start:
     77					     ;
     78	0100  B8 B800			     mov ax, 0B800h
     79	0103  8E C0			     mov es, ax
     80
     81					     ; Подумать	как можно передавать символ для	всех рамок
     82
     83
     84	0105  8A 0E 0080		     mov cl, ds:80h
     85	0109  BE 0082			     mov si, 82h
     86					     ;mov di, cx
     87
     88					     DRAW_FRAME_WORD 30, 5, 10,	3, 2
1    89
1    90	010C  E8 00E9			     call get_num_from_command ; получаем индекс в массиве символов
1    91					     DRAW_FRAME	30, 5, 10, 3, 2
2    92
2    93	010F  D1 E2			     shl dx, 1 ; arr of	words
2    94	0111  BB 0154r			     lea bx, Symbol_arr
2    95	0114  03 DA			     add bx, dx
2    96
2    97	0116  51			     push cx
2    98	0117  FF 37			     push [bx]
2    99
2   100					     DRAW_STR 30, 10, 3, 2
3   101	0119  BB 001E			     mov  bx, 30
3   102	011C  B9 000A			     mov  cx, 10
3   103	011F  BF 0003			     mov  di, 3
3   104
3   105					     ; mov  ax,	2
3   106					     ; push ax
3   107
3   108	0122  E8 0037			     call draw_string
2   109					     DRAW_COL 5, 10, 3,	2
3   110	0125  BB 0005			     mov bx, 5
3   111	0128  B9 000A			     mov cx, 10
3   112	012B  BF 0003			     mov di, 3
3   113
3   114					     ; mov ax, 2
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 3
frame.asm



3   115					     ; push ax
3   116
3   117	012E  E8 005F			     call draw_column
2   118
2   119	      =0007			     Sum_y = 3 + 5 - 1
2   120	      =0027			     Sum_x = 10	+ 30 - 1
2   121
2   122					     DRAW_STR 30, 10, Sum_y, 2
3   123	0131  BB 001E			     mov  bx, 30
3   124	0134  B9 000A			     mov  cx, 10
3   125	0137  BF 0007			     mov  di, Sum_y
3   126
3   127					     ; mov  ax,	2
3   128					     ; push ax
3   129
3   130	013A  E8 001F			     call draw_string
2   131					     DRAW_COL 5, Sum_x,	3, 2
3   132	013D  BB 0005			     mov bx, 5
3   133	0140  B9 0027			     mov cx, Sum_x
3   134	0143  BF 0003			     mov di, 3
3   135
3   136					     ; mov ax, 2
3   137					     ; push ax
3   138
3   139	0146  E8 0047			     call draw_column
2   140
2   141	0149  83 C4 02			     add sp, 2
2   142	014C  59			     pop cx
2   143
1   144	      =0352			     BEG = (Sum_y + 3) / 2 * 160 + 10 *	2 + 30
1   145
    146
    147	014D  E8 0081			     call print_word_in_frame
    148
    149					     ;pop bx
    150				     ;	     DRAW_STR 10, 5, 3,	1F03h
    151				     ;	     DRAW_COL 6,  10, 0, 1F03h
    152				     ;
    153				     ;	     DRAW_STR 29, 10, 5
    154				     ;	     DRAW_COL 6,  40, 0
    155
    156
    157
    158
    159					     ;DRAW_FRAME 8, 3, 1, 1, 1F03h or 8080h
    160
    161	0150  B4 4C			     mov ah, 4ch
    162	0152  CD 21			     int 21h
    163
    164	0154  1F03 4E03	8B55 04C5	     Symbol_arr	dw 1F03h, 4E03h, 8B55h,	04C5h
    165
    166
    167	015C				     draw_string proc
    168	015C  55				     push bp
    169	015D  8B EC				     mov bp, sp
    170	015F  83 C5 04				     add bp, 4
    171						     ;mov word ptr es: [bx+160*4l + 80], (4e03h	or 8000h)
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 4
frame.asm



    172						     ;mov bx, 80 ;
    173
    174						     ;cx pos_x
    175						     ;di pos_y
    176	0162  4B				     dec bx
    177	0163  D1 E1				     shl cx, 1	     ;
    178	0165  D1 E3				     shl bx, 1	     ;
    179
    180					     ;===== Умножение смещения на 160=======
    181	0167  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    182	      E7 D1 E7
    183	0171  53				     push bx
    184	0172  8B DF				     mov bx, di
    185	0174  D1 E7 D1 E7			     shl di, 2
    186	0178  03 FB				     add di, bx
    187	017A  5B				     pop bx
    188					     ;=================================
    189	017B  03 F9				     add di, cx
    190						     ;add bx, cx
    191
    192	017D  51				     push cx
    193	017E  33 C9				     xor cx, cx
    194	0180  8B 4E 00				     mov word ptr cx, [bp]
    195
    196	0183					     string:
    197	0183  26: 89 09					     mov word ptr es:[bx + di],	cx
    198	0186  4B					     dec bx
    199	0187  4B					     dec bx
    200	0188  83 FB 00					     cmp bx, 0
    201	018B  7D F6					     jge string
    202
    203	018D  59				     pop cx
    204
    205	018E  5D				     pop bp
    206
    207	018F  C3				     ret
    208
    209	0190				     draw_string endp
    210
    211	0190				     draw_column proc
    212	0190  55				     push bp
    213	0191  8B EC				     mov bp, sp
    214	0193  83 C5 04				     add bp, 4 ; пропускаем адрес возврата
    215
    216						     ;cx pos_x
    217						     ;di pos_y
    218	0196  4B				     dec bx
    219	0197  D1 E1				     shl cx, 1	     ; 2 байта на символ
    220	0199  D1 E3				     shl bx, 1	     ; 2 байта на символ
    221
    222						     ;===== Умножение смещения y на 160=======
    223	019B  D1 E7 D1 E7 D1 E7	D1+		     shl di, 5
    224	      E7 D1 E7
    225	01A5  53				     push bx
    226	01A6  8B DF				     mov bx, di
    227	01A8  D1 E7 D1 E7			     shl di, 2
    228	01AC  03 FB				     add di, bx
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 5
frame.asm



    229	01AE  5B				     pop bx
    230						     ;=====================================
    231
    232	01AF  50				     push ax
    233	01B0  51				     push cx
    234	01B1  8B C3				     mov ax, bx
    235	01B3  B9 0050				     mov cx, 80
    236	01B6  F7 E1				     mul cx
    237	01B8  8B D8				     mov bx, ax
    238	01BA  59				     pop cx
    239	01BB  58				     pop ax
    240
    241	01BC  03 F9				     add di, cx
    242
    243	01BE  51				     push cx
    244	01BF  8B 4E 00				     mov word ptr cx, [bp]
    245
    246	01C2					     print_column:
    247	01C2  26: 89 09					     mov word ptr es:[bx + di],	cx
    248	01C5  81 EB 00A0				     sub bx, 160
    249							     ;dec bx
    250	01C9  83 FB 00					     cmp bx, 0
    251	01CC  7D F4					     jge print_column
    252
    253	01CE  59				     pop cx
    254	01CF  5D				     pop bp
    255
    256	01D0  C3				     ret
    257
    258
    259	01D1				     draw_column endp
    260				     ;====================================================================
    261				     ;Start:
    262				     ;	 cx - counter of symbols
    263				     ;	     si	- adress of string
    264				     ;Return: ax - число
    265				     ;Destr: cx, di, si
    266				     ;====================================================================
    267	01D1				     print_word_in_frame proc
    268							     ; push cx
    269	01D1  49					     dec cx
    270	01D2  57					     push di
    271	01D3  83 C6 01					     add si, 1 ; skip_space
    272							     ;xor cx, cx
    273	01D6  33 FF					     xor di, di
    274							     ;mov cl, ds:80h
    275
    276	01D8  80 F9 00					     cmp cl, 0
    277	01DB  74 19					     je	@@return
    278
    279	01DD  FE C9					     dec cl
    280							     ;mov si, 82h
    281							     ;BEG equ 5	* 160 +	40
    282	01DF  8B F9					     mov di, cx
    283	01E1  D1 EF D1 EF				     shr di, 2
    284	01E5  D1 E7					     shl di, 1
    285	01E7  F7 DF					     neg di
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 6
frame.asm



    286	01E9  83 EF 02					     sub di, 2
    287	01EC  81 C7 0352				     add di, BEG
    288							     ;mov di, BEG ;  
    289	01F0  B4 9F					     mov ah, (1Fh or 88h) ;
    290	01F2						     L:
    291	01F2  AC						     lodsb
    292	01F3  AB						     stosw
    293	01F4  E2 FC						     loop L
    294
    295	01F6						     @@return:
    296	01F6  5F					     pop di
    297							     ; pop cx
    298	01F7  C3					     ret
    299	01F8				     endp
    300
    301				     ;====================================================================
    302				     ; Start:  cx - number of symbols
    303				     ;		       si - adress of string
    304				     ; Destr:  cx, si, dx, ax
    305				     ; Return: dx - число
    306				     ;====================================================================
    307	01F8				     get_num_from_command proc
    308	01F8  80 3C 20				     cmp byte ptr[si], ' '
    309	01FB  74 F9				     je	@@return
    310	01FD  33 C0				     xor ax, ax
    311	01FF  33 D2				     xor dx, dx
    312
    313	0201					      @@digit:
    314	0201  AC					     lodsb
    315
    316	0202  51					     push cx
    317	0203  8B CA					     mov cx, dx
    318	0205  D1 E2 D1 E2 D1 E2				     shl dx, 3
    319	020B  03 D1					     add dx, cx
    320	020D  03 D1					     add dx, cx
    321	020F  59					     pop cx
    322
    323							     ;sub ax, '0'
    324	0210  24 0F					     and al, 0fh
    325	0212  03 D0					     add dx, ax
    326	0214  49					     dec cx
    327
    328	0215  80 3C 20					     cmp byte ptr [si],	' '
    329	0218  75 E7					     jne @@digit
    330
    331	021A					     @return:
    332	021A  C3				     ret
    333	021B				     endp
    334
    335
    336				     end     Start
Turbo Assembler	 Version 4.1	    02/15/26 12:57:45	    Page 7
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/15/26"
??FILENAME			  Text	 "frame	  "
??TIME				  Text	 "12:57:45"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@				  Number [DGROUP:BP-0002]
@@DIGIT				  Near	 DGROUP:0201
@@RETURN			  Near	 DGROUP:01F6
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 FRAME
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@RETURN				  Near	 DGROUP:021A
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BEG				  Number 0352
DRAW_COLUMN			  Near	 DGROUP:0190
DRAW_STRING			  Near	 DGROUP:015C
GET_NUM_FROM_COMMAND		  Near	 DGROUP:01F8
L				  Near	 DGROUP:01F2
PRINT_COLUMN			  Near	 DGROUP:01C2
PRINT_WORD_IN_FRAME		  Near	 DGROUP:01D1
START				  Near	 DGROUP:0100
STRING				  Near	 DGROUP:0183
SUM_X				  Number 0027
SUM_Y				  Number 0007
SYMBOL_ARR			  Word	 DGROUP:0154

Macro Name

DRAW_COL
DRAW_FRAME
DRAW_FRAME_WORD
DRAW_STR

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  021B Word	  Public  CODE
